
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../usage/">
      
      
        <link rel="next" href="../api/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Framework - NNfluxnu</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#a-brief-overview-of-the-nnfluxnu-framework" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="NNfluxnu" class="md-header__button md-logo" aria-label="NNfluxnu" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NNfluxnu
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Framework
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="NNfluxnu" class="md-nav__button md-logo" aria-label="NNfluxnu" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    NNfluxnu
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Framework
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Framework
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#equivalence-with-nnpdf" class="md-nav__link">
    <span class="md-ellipsis">
      Equivalence with NNPDF
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dis-neutrino-fluxes-and-event-rate-measurements" class="md-nav__link">
    <span class="md-ellipsis">
      DIS, neutrino fluxes and event rate measurements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fast-kernel-tables-computational-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      Fast-Kernel tables: computational efficiency
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-machine-learning-model" class="md-nav__link">
    <span class="md-ellipsis">
      The Machine Learning model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hyperoptimization-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Hyperoptimization algorithm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postfit-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Postfit analysis
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#equivalence-with-nnpdf" class="md-nav__link">
    <span class="md-ellipsis">
      Equivalence with NNPDF
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dis-neutrino-fluxes-and-event-rate-measurements" class="md-nav__link">
    <span class="md-ellipsis">
      DIS, neutrino fluxes and event rate measurements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fast-kernel-tables-computational-efficiency" class="md-nav__link">
    <span class="md-ellipsis">
      Fast-Kernel tables: computational efficiency
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-machine-learning-model" class="md-nav__link">
    <span class="md-ellipsis">
      The Machine Learning model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hyperoptimization-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Hyperoptimization algorithm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postfit-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Postfit analysis
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="a-brief-overview-of-the-nnfluxnu-framework">A brief overview of the NNfluxnu framework<a class="headerlink" href="#a-brief-overview-of-the-nnfluxnu-framework" title="Permanent link">&para;</a></h1>
<h2 id="equivalence-with-nnpdf">Equivalence with NNPDF<a class="headerlink" href="#equivalence-with-nnpdf" title="Permanent link">&para;</a></h2>
<p>First of all, the framework is based on the NNPDF framework, which uses feed-forward NNs to fit PDFs from DIS structure functions. The equivalence with NNPDF is exploited in large parts of this framework.</p>
<h2 id="dis-neutrino-fluxes-and-event-rate-measurements">DIS, neutrino fluxes and event rate measurements<a class="headerlink" href="#dis-neutrino-fluxes-and-event-rate-measurements" title="Permanent link">&para;</a></h2>
<p>The neutrinos at the LHC are decay products of forward hadron production. These hadrons are produced from pp collisions at ATLAS. The neutrinos go in the forward direction and eventually arrive ~500m downstream the FASER/SND@LHC experiments. At the FASER experiment the neutrino react via deep inelastic scattering using a Tungsten target.
First of all it is important to know how the neutrino fluxes and the event rate measurements are related to each other by DIS variables and kinematic variables.</p>
<p>The neutrinos react via tungsten using deep inelastic scattering like this:
<img alt="dis_feynman" src="../img/feynman_dis.png" /></p>
<p>Where kinematic variables and the DIS variables are related to each other by:
<img alt="dis_var" src="../img/dis_var.png" /></p>
<p>In terms of these variables the charged current event rates are related to the neutrino flux by three integrals expressed in this equation:
<img alt="events_int" src="../img/events_int.png" />
where the integrand is given by
<img alt="integrand" src="../img/integrand.png" />
where:
<img alt="ntlt" src="../img/ntlt.png" />
and
<img alt="cross_sect" src="../img/cross_sect.png" />
is the double differential cross section expressed in terms of DIS structure functions. And finally,
<img alt="acc_factor" src="../img/acc_factor.png" /></p>
<h2 id="fast-kernel-tables-computational-efficiency">Fast-Kernel tables: computational efficiency<a class="headerlink" href="#fast-kernel-tables-computational-efficiency" title="Permanent link">&para;</a></h2>
<p>As can be seen from the equations above, the flux and the event rates are related to each other through several integrals. When trying to parametrise a neutrino flux using an NN this is very computationally expensive, since every new try for the flux results in having to do several integrals. This is why Fast-Kernel are used in this framework to replace the convolutions by a single matrix multiplication. The idea is to take the neutrino flux outside of the integral by expressing it in terms of al inear expansion using Lagrange polynomials. In order to arrive at this result, first the neutrino PDF is defined as :
<img alt="neutrinopdf" src="../img/neutrinopdf.png" />
Where <span class="arithmatex">\(x_\nu\)</span> is the momentum fraction and is defined as:
<img alt="xnu" src="../img/xnu.png" />
and where <span class="arithmatex">\(s_pp\)</span> is the center of mass from the proton-proton collision. </p>
<p>The neutrino PDF is then expressed in a linear expansion in an interpolation basis:
<img alt="interpolation" src="../img/interpolation.png" /></p>
<p>Where <span class="arithmatex">\(I_\alpha(x_\nu)\)</span> are Lagrange polynomials</p>
<p>Then the number of events are related to the neutrino PDF as follows:
<img alt="events_pdf" src="../img/events_pdf.png" /></p>
<p>And the FK-table is given by
<img alt="fk_table" src="../img/fk_table.png" /></p>
<p>And the number of scattering events, the fk-table and the neutrino PDF are then related to each other as follows:
<img alt="efficient_events" src="../img/efficient_events.png" /></p>
<p>A schematic picture of what happens is displayed below:</p>
<p><img alt="FK_table_visual" src="../img/FK_table.pdf" /></p>
<h2 id="the-machine-learning-model">The Machine Learning model<a class="headerlink" href="#the-machine-learning-model" title="Permanent link">&para;</a></h2>
<p>The structure of the machine learning model looks like:</p>
<p><img alt="structure_nn" src="../img/structure_nn.png" /></p>
<p>A preprocessing function is imposed to increase computational efficiency, smooth the paramterisation and impose non-divergent behaviour at low and high x. The NN used in the framework contains a few hidden layers with a few nodes. The loss is defined as:
<img alt="loss" src="../img/loss.png" /></p>
<p>There is also an option to extend the loss to also make sure the neutrino PDF is positive definite when this is not imposed by the activation functions.</p>
<p>When training the NN, a so-called stopping algorithm is employed, which looks like:
<img alt="stopping" src="../img/stopping.png" /></p>
<p>The idea is to stop training when the loss stops decreasing with a number of patience epochs to prevent the training from stopping too early.</p>
<p>As is the case in NNPDF, the uncertainties on the neutrino PDFs are computed by running so-called closure tests. Using the errors on the data, N Monte Carlo replicas are produced and fitted. Then, the mean and standard deviation is computed using N neutirno PDFs from these N fits. </p>
<p>The specific parameters used in this work, like the activation function and the optimizer can be found in the fit_settings.yaml file. </p>
<h2 id="hyperoptimization-algorithm">Hyperoptimization algorithm<a class="headerlink" href="#hyperoptimization-algorithm" title="Permanent link">&para;</a></h2>
<p>An hyperparameter optimization algorithm is also available. The idea behind this algorithm is generality i.e. the methodology should work for all datasets, provided the hyperparameters chosen are sensible. The algorithm in this work uses k-fold cross validation and bayesian optimization to find the best set of hyperparameters. The idea behind k-fold cross validation is to fit the entire dataset consisting of k-folds, except for one. This is then iterated until all possible partitions have been fitted. The hyperparameters which produced the lowest mean loss is then used to run the fit. Bayesian optimization is employed to find this minimum.</p>
<h2 id="postfit-analysis">Postfit analysis<a class="headerlink" href="#postfit-analysis" title="Permanent link">&para;</a></h2>
<p>The postfit analysis consists of two parts: postift criteria and postfit measures. The first one checks if there is a certain fitted neutrino PDF which did not converge. For example, if the <span class="arithmatex">\(\chi^2\)</span> from a particular replica deviates more than 4<span class="arithmatex">\(\sigma\)</span> from the mean <span class="arithmatex">\(\chi^2\)</span> computed using all the replicas, this replica is discarded. The postfit measures are used to assess the quality of the fit using several statistical measures, such as computing the degree to which the fit has been an overfit/underfit. </p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.math"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>